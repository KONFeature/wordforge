# @wordforge/ui - React Admin UI

React components for WordPress admin pages (chat interface, settings).

## Commands

```bash
bun run build                 # Build → ../php/assets/js/
bun run start                 # Watch mode with HMR
bun run typecheck             # Type-check (tsc --noEmit)
bun run lint                  # Lint with Biome
bun run lint:fix              # Auto-fix
```

## Directory Structure

```
src/
├── chat/                     # Chat interface
│   ├── components/           # UI components
│   ├── hooks/                # React hooks (useSessions, useMessages, etc.)
│   ├── ChatApp.tsx           # Main chat component
│   ├── useOpencodeClient.ts  # OpenCode SDK client
│   └── index.tsx             # Entry point
├── settings/                 # Settings page
│   ├── components/           # Settings cards
│   ├── hooks/                # Settings hooks
│   ├── SettingsApp.tsx       # Main settings component
│   └── index.tsx             # Entry point
├── widget/                   # Compact chat widget
│   └── index.tsx             # Entry point
├── lib/                      # Shared utilities
│   ├── query-client.ts       # React Query client
│   └── QueryProvider.tsx     # Provider wrapper
├── styles/                   # Global styles
│   └── variables.css         # CSS custom properties
└── types.ts                  # Shared types
```

## Build Output

Builds to `packages/php/assets/js/`:
- `chat.js`, `chat.asset.php`
- `settings.js`, `settings.asset.php`
- `chat-widget.js`, `chat-widget.asset.php`

The `.asset.php` files are auto-generated by wp-scripts. **Do not edit manually.**

## Code Style

### CRITICAL: WordPress React, Not External React
```typescript
// CORRECT - WordPress bundled React
import { useState, useEffect, useCallback } from '@wordpress/element';
import { Button, Card, Spinner, Notice } from '@wordpress/components';
import { __ } from '@wordpress/i18n';

// WRONG - Never import from 'react' directly
import { useState } from 'react';  // NO!
```

Webpack aliases `react` → `@wordpress/element` for third-party libs (TanStack Query), but your code should import directly from `@wordpress/element`.

### Components
```typescript
// Arrow functions, typed props, CSS Modules
import styles from './MyComponent.module.css';

interface MyComponentProps {
  title: string;
  isLoading?: boolean;
  onAction: () => void;
}

export const MyComponent = ({ title, isLoading, onAction }: MyComponentProps) => {
  const [state, setState] = useState<string>('');

  if (isLoading) {
    return <Spinner />;
  }

  return (
    <div className={styles.container}>
      <h2>{title}</h2>
      <Button variant="primary" onClick={onAction}>
        {__('Click me', 'wordforge')}
      </Button>
    </div>
  );
};
```

### CSS Modules
```css
/* MyComponent.module.css */
.container {
  padding: var(--spacing-md);
  background: var(--color-background);
}

.title {
  color: var(--color-text);
  font-size: var(--font-size-lg);
}
```

```typescript
import styles from './MyComponent.module.css';
// Access as: styles.container, styles.title
```

### Hooks Pattern (React Query)
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

export const SESSIONS_KEY = ['sessions'] as const;

export const useSessions = (client: OpencodeClient | null) => {
  return useQuery({
    queryKey: SESSIONS_KEY,
    queryFn: async () => {
      const result = await client!.session.list();
      return result.data ?? [];
    },
    enabled: !!client,
  });
};

export const useCreateSession = (client: OpencodeClient | null) => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async () => {
      const result = await client!.session.create({ body: {} });
      return result.data!;
    },
    onSuccess: (newSession) => {
      queryClient.setQueryData<Session[]>(SESSIONS_KEY, (old) =>
        old ? [newSession, ...old] : [newSession],
      );
    },
  });
};
```

### Window Config
WordPress passes config via global variables:
```typescript
// Declared in types.ts
declare global {
  interface Window {
    wordforgeChat?: ChatConfig;
    wordforgeSettings?: SettingsConfig;
  }
}

// Usage in component
const config = window.wordforgeChat;
if (!config) {
  return <div>Configuration missing</div>;
}
```

## WordPress Components

Common components from `@wordpress/components`:

| Component | Usage |
|-----------|-------|
| `Button` | Actions, links |
| `Card`, `CardBody`, `CardHeader` | Panels |
| `Spinner` | Loading states |
| `Notice` | Alerts, errors |
| `TextControl` | Text inputs |
| `SelectControl` | Dropdowns |
| `ToggleControl` | On/off switches |
| `Modal` | Dialogs |
| `Flex`, `FlexItem` | Layout |

```typescript
import { Button, Card, CardBody, Spinner, Notice } from '@wordpress/components';
```

## Internationalization

```typescript
import { __ } from '@wordpress/i18n';

// Simple string
<Button>{__('Save', 'wordforge')}</Button>

// With context
<span>{__('Status', 'wordforge')}</span>
```

## Common Pitfalls

1. **Importing from 'react'** - Always use `@wordpress/element`. The webpack alias exists for third-party libs only.

2. **Missing CSS Module import** - Styles won't apply if you forget `import styles from './X.module.css'`

3. **Non-null assertions** - `client!.method()` is allowed (biome config), but check `enabled: !!client` in queries

4. **Window config undefined** - Always guard against missing `window.wordforgeChat`

5. **Asset files** - Never edit `.asset.php` files, they're auto-generated

6. **TanStack Query keys** - Use `as const` for type-safe query keys: `['sessions'] as const`
