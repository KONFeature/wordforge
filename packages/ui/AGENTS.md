# @wordforge/ui - React Admin UI

React components for WordPress admin. Builds to `packages/php/assets/js/`.

## Commands

```bash
bun run build        # Build → ../php/assets/js/
bun run start        # Watch mode (HMR)
bun run typecheck    # tsc --noEmit
bun run lint         # Biome
```

## Structure

```
src/
├── chat/                 # Full chat interface
│   ├── components/       # ChatMessage, MessageList, etc.
│   ├── hooks/            # useSessions, useMessages, useTools
│   ├── ChatApp.tsx       # Main component
│   └── index.tsx         # Entry
├── settings/             # Settings page
│   ├── components/       # ProvidersCard, AgentsCard, etc.
│   ├── hooks/            # useSettings, useProviders
│   └── index.tsx         # Entry
├── widget/               # Floating chat widget
│   └── index.tsx         # Entry
├── editor/               # Gutenberg sidebar
│   └── index.tsx         # Entry
├── lib/                  # Shared utilities
│   ├── query-client.ts   # React Query
│   └── QueryProvider.tsx
└── types.ts              # Global types
```

## CRITICAL: WordPress React

```typescript
// CORRECT - WordPress bundled React
import { useState, useEffect } from '@wordpress/element';
import { Button, Card, Spinner } from '@wordpress/components';
import { __ } from '@wordpress/i18n';

// WRONG - Never do this
import { useState } from 'react';  // NO!
```

Webpack aliases `react` → `@wordpress/element` for TanStack Query, but YOUR code imports from `@wordpress/element` directly.

## Component Pattern

```typescript
import { useState } from '@wordpress/element';
import { Button, Spinner } from '@wordpress/components';
import { __ } from '@wordpress/i18n';
import styles from './MyComponent.module.css';

interface Props {
  title: string;
  onAction: () => void;
}

export const MyComponent = ({ title, onAction }: Props) => {
  const [loading, setLoading] = useState(false);

  if (loading) return <Spinner />;

  return (
    <div className={styles.container}>
      <Button variant="primary" onClick={onAction}>
        {__('Click', 'wordforge')}
      </Button>
    </div>
  );
};
```

## Hooks (TanStack Query)

```typescript
import { useQuery, useMutation } from '@tanstack/react-query';

export const SESSIONS_KEY = ['sessions'] as const;

export const useSessions = (client: OpencodeClient | null) => {
  return useQuery({
    queryKey: SESSIONS_KEY,
    queryFn: () => client!.session.list().then(r => r.data ?? []),
    enabled: !!client,
  });
};
```

## Window Config

WordPress passes config via globals:

```typescript
const config = window.wordforgeChat;
if (!config) return <div>Missing config</div>;
```

Declared in `types.ts`:
```typescript
declare global {
  interface Window {
    wordforgeChat?: ChatConfig;
    wordforgeSettings?: SettingsConfig;
  }
}
```

## Build Output

| Entry | Output |
|-------|--------|
| `chat/index.tsx` | `chat.js`, `chat.asset.php` |
| `settings/index.tsx` | `settings.js`, `settings.asset.php` |
| `widget/index.tsx` | `chat-widget.js`, `chat-widget.asset.php` |
| `editor/index.tsx` | `editor.js`, `editor.asset.php` |

**Never edit `.asset.php`** - auto-generated by wp-scripts.

## Anti-Patterns

| Don't | Why |
|-------|-----|
| `import from 'react'` | Must use `@wordpress/element` |
| Edit `.asset.php` | Auto-generated |
| Skip `enabled: !!client` | Prevents null errors in queries |
| Forget CSS Module import | Styles won't apply |
| Hardcode strings | Use `__('text', 'wordforge')` |
